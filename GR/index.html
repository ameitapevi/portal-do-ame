<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel de Gerenciamento de Riscos e Oportunidades</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../assets/css/base.css">
  
</head>

<body>
  <!-- ===== TOPBAR ===== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img src="../assets/img/logo-ame.png" alt="Logo AME" />
        <div class="brand-title">
          <strong>AME - Itapevi</strong>
          <span>Gerenciamento de Riscos e Oportunidades</span>
        </div>
      </div>

    <nav class="nav">
      <a href="../">Portal do AME - Itapevi</a>
      <a href="#visao-geral">G&amp;R</a>
      <a href="../protocolos/">Protocolos</a>
      <a href="../seguranca do paciente/">Segurança do Paciente</a>
    </nav>
  </div>
</div>

  <!-- ===== BANNER ===== -->
  <header class="site-header">
    <div class="site-banner">
      <div class="site-banner-bg"></div>
      <div class="site-title">G&amp;R AME – ITAPEVI</div>
    </div>
  </header>

  <div class="container">

    <!-- ===== HERO ===== -->
    <section id="visao-geral" class="hero">
      <div class="hero-text">
        <div class="chip-row">
          <span class="chip chip-blue">Painel G&amp;R</span>
          <span class="chip chip-green">Revisão semestral</span>
        </div>

        <h2>Visão geral</h2>

        <p>
          Este painel tem como objetivo centralizar, de forma organizada e transparente, 
          os documentos oficiais de Gerenciamento de Riscos e Oportunidades das áreas do AME 
          Itapevi. A ferramenta permite o acompanhamento sistemático dos prazos de revisão, 
          com identificação automática do status de cada documento (OK, ALERTA ou VENCIDO), 
          apoiando a tomada de decisão, o planejamento das ações corretivas e a governança dos 
          processos. Dessa forma, o painel contribui para o fortalecimento da cultura de qualidade, 
          segurança e melhoria contínua na unidade.
        </p>
    
        <p>
          O Gerenciamento de Riscos e Oportunidades no AME – Ambulatório Médico de Especialidades
           é um instrumento fundamental para a identificação, análise e mitigação de riscos que possam 
           impactar a assistência, a segurança do paciente e a continuidade dos serviços. Alinhado às 
           diretrizes da Organização Pan-Americana da Saúde (OPAS), esse processo contribui para o 
           fortalecimento da cultura de qualidade, da governança institucional e da melhoria contínua 
           dos processos assistenciais e administrativos.

        </p>

        <div class="kpis">
          <div class="kpi">
            <div class="label">⏳ Periodicidade</div>
            <div class="value">6 meses</div>
          </div>
          <div class="kpi">
            <div class="label">⚠️ Critério de alerta</div>
            <div class="value">30 dias</div>
          </div>
          
          <div class="kpi">
            <div class="label">✅ Acesso</div>
            <div class="value">PDF oficial</div>
          </div>
        </div>
      </div>

      <div class="hero-image">
        <img src="CORPO.PNG" alt="Imagem de apoio" />
      </div>
    </section>

    <p class="lead">
      Centralização dos acessos aos Gerenciamentos de Riscos e Oportunidades por área da unidade.
    </p>

    <!-- ===== RESUMO ===== -->
    <div class="section-title">
      <div>Resumo do painel <small>(contagem automática)</small></div>
    </div>

    <div class="summary">
      <div class="summary-card">
        <div class="slabel">Total de áreas</div>
        <div class="svalue" id="sumTotal">0</div>
      </div>
      <div class="summary-card ok">
        <div class="slabel">OK</div>
        <div class="svalue" id="sumOk">0</div>
      </div>
      <div class="summary-card alerta">
        <div class="slabel">ALERTA</div>
        <div class="svalue" id="sumAlerta">0</div>
      </div>
      <div class="summary-card vencido">
        <div class="slabel">VENCIDO</div>
        <div class="svalue" id="sumVencido">0</div>
      </div>
    </div>

    <div class="filters" aria-label="Filtros de status">
      <button class="filter-btn active" type="button" data-filter="ALL">Todos</button>
      <button class="filter-btn" type="button" data-filter="OK">OK</button>
      <button class="filter-btn" type="button" data-filter="ALERTA">ALERTA</button>
      <button class="filter-btn" type="button" data-filter="VENCIDO">VENCIDO</button>
    </div>

    <!-- ===== BUSCA ===== -->
    <div class="toolbar">
      <div class="search-wrap">
        <label for="searchInput"><strong>Pesquisar área:</strong></label>
        <input id="searchInput" type="text" placeholder="Ex.: Enfermagem, Faturamento, Segurança..." />
        <button id="clearBtn" type="button">Limpar</button>
      </div>
      <div id="resultCount"></div>
    </div>

    <section id="areas">
      <div class="section-title">
        <div>Áreas <small>(documentos oficiais)</small></div>
      </div>



      <div class="cards" id="cardsContainer">

        <!-- 1. Atendimento -->
        <div class="card" data-area="Atendimento" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Atendimento <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="1. Gerenciamento de Riscos e Oportunidades - Atendimento.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 2. Agendamento -->
        <div class="card" data-area="Agendamento" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Agendamento <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="2. Gerenciamento de Riscos e Oportunidades - Agendamento.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
              
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 3. Segurança do Trabalho -->
        <div class="card" data-area="Segurança do Trabalho" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Segurança do Trabalho <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="3. Gerenciamento de Riscos e Oportunidades - Segurança Trabalho.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
              
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 4. Facilities -->
        <div class="card" data-area="Facilities" data-revisao="2025-09-29" data-entrega="2025-09-26">
          <h3>Facilities <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="4. Gerenciamento de Riscos e Oportunidades - Facilities.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
              
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 5. Suprimentos -->
        <div class="card" data-area="Suprimentos" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Suprimentos <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="5. Gerenciamento de Riscos e Oportunidades - Suprimentos.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
             
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 6. Serviço Social -->
        <div class="card" data-area="Serviço Social" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Serviço Social <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="6. Gerenciamento de Riscos e Oportunidades - Serviço Social.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
             
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 7. Controladoria -->
        <div class="card" data-area="Controladoria" data-revisao="2025-09-25" data-entrega="2025-09-24">
          <h3>Controladoria <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="7. Gerenciamento de Riscos e Oportunidades - Controladoria.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
              
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 8. Faturamento -->
        <div class="card" data-area="Faturamento" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Faturamento <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="8. Gerenciamento de Riscos e Oportunidades - Faturamento.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
              
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 9. Área Médica -->
        <div class="card" data-area="Área Médica" data-revisao="2025-09-26" data-entrega="2025-09-25">
          <h3>Área Médica <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="9. Gerenciamento de Riscos e Oportunidades - Área Médica.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
             
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

        <!-- 10. Enfermagem -->
        <div class="card" data-area="Enfermagem" data-revisao="2025-09-29" data-entrega="2025-09-26">
          <h3>Enfermagem <span class="status">G&amp;R</span></h3>
          <div class="links">
            <a href="10. Gerenciamento de Riscos e Oportunidades - Enfermagem.pdf" target="_blank">Documento oficial</a>
          </div>
          <div class="meta">
            <div class="meta-row">
              <div><strong>Revisão realizada em:</strong> <span class="last-review"></span></div>
             
            </div>
            <div><strong>Próxima revisão (6 meses):</strong> <span class="next-review"></span></div>
            <div><strong>Data de entrega:</strong> <span class="delivery-date"></span></div>
          </div>
        </div>

      </div>

      <div id="noResults">
        Nenhuma área encontrada com esse termo. Verifique a grafia ou tente outro nome.
      </div>
    </section>

    <section id="sobre">
      <div class="section-title">
        <div>Sobre <small>(governança do painel)</small></div>
      </div>

      <!-- ===== BLOCO: IMAGEM À ESQUERDA + TEXTO À DIREITA ===== -->
      <div class="hero hero-secondary">
        <div class="hero-image">
          <img src="Gerenciamento.PNG" alt="Gerenciamento de Riscos e Oportunidades">
        </div>

        <div class="hero-text">
          <h2>Gerenciamento de Riscos e Oportunidades</h2>

          <p>
            O Gerenciamento de Riscos e Oportunidades no AME – Ambulatório Médico de Especialidades
            é um instrumento fundamental para a identificação, análise e mitigação de riscos que
            possam impactar a assistência, a segurança do paciente e a continuidade dos serviços.
            Alinhado às diretrizes da Organização Pan-Americana da Saúde (OPAS), esse processo
            contribui para o fortalecimento da cultura de qualidade, da governança institucional
            e da melhoria contínua dos processos assistenciais e administrativos.
          </p>

          <p>
            No contexto do AME, esse gerenciamento é realizado de forma integrada, com a participação
            de todas as áreas da unidade, promovendo a cultura de segurança, o engajamento das equipes
            e a tomada de decisão baseada em evidências. Dessa forma, a unidade reafirma seu compromisso
            com uma assistência segura, humanizada e alinhada às boas práticas de governança em saúde.
          </p>
        </div>
      </div>


      <div class="meta">      
        <div><strong>Responsável técnico:</strong> Gestão de Qualidade – Wally Silva de Jesus</div>
        <div><strong>Última atualização:</strong> 12/12/2025</div>
        <div style="margin-top:8px;color:var(--muted);">
          Este painel centraliza os acessos aos documentos oficiais por área e calcula automaticamente o status de prazo
          conforme periodicidade de 6 meses e alerta em 30 dias.
        </div>
      </div>
    </section>

    <footer>
      © AME Itapevi – Painel de Gerenciamento de Riscos e Oportunidades
    </footer>

  </div>

<script>
(function () {
  // ===== SCROLL SUAVE NO MENU =====
  const topbar = document.querySelector('.topbar');
  document.querySelectorAll('.nav a[href^="#"]').forEach(link => {
    link.addEventListener('click', (e) => {
      const id = link.getAttribute('href');
      const target = document.querySelector(id);
      if (!target) return;

      e.preventDefault();
      const top = target.getBoundingClientRect().top + window.pageYOffset;
      const offset = (topbar ? topbar.offsetHeight : 0) + 10;
      window.scrollTo({ top: top - offset, behavior: 'smooth' });
    });
  });

  // ===== GOOGLE SHEETS -> PAINEL =====
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQKR0ek618-XQO7zpdxYuAiYD78mfmhiFtOyIrfyuZgMhUetNKFtV3GzRpfUEO1orwKL7ZVKIW8MsFF/pub?output=csv";
  const ALERT_DAYS = 30;

  function normalize(text) {
    return (text || "")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  }

  function parseCSV(csvText) {
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i = 0; i < csvText.length; i++) {
      const ch = csvText[i];
      const next = csvText[i + 1];

      if (ch === '"' && inQuotes && next === '"') { cur += '"'; i++; continue; }
      if (ch === '"') { inQuotes = !inQuotes; continue; }

      if (ch === "," && !inQuotes) { row.push(cur); cur = ""; continue; }

      if ((ch === "\n" || ch === "\r") && !inQuotes) {
        if (cur.length || row.length) { row.push(cur); rows.push(row); }
        row = []; cur = "";
        if (ch === "\r" && next === "\n") i++;
        continue;
      }
      cur += ch;
    }

    if (cur.length || row.length) { row.push(cur); rows.push(row); }
    return rows;
  }

  function toISODateString(value) {
    const v = (value || "").trim();
    if (!v) return "";

    if (/^\d{4}-\d{2}-\d{2}$/.test(v)) return v;

    const m = v.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
    if (m) return `${m[3]}-${m[2]}-${m[1]}`;

    return "";
  }

  function parseISODate(iso) {
    if (!iso) return null;
    const [y, m, d] = iso.split("-").map(Number);
    if (!y || !m || !d) return null;
    return new Date(y, m - 1, d);
  }

  function formatBR(date) {
    if (!date) return "—";
    const dd = String(date.getDate()).padStart(2, "0");
    const mm = String(date.getMonth() + 1).padStart(2, "0");
    const yyyy = date.getFullYear();
    return `${dd}/${mm}/${yyyy}`;
  }

  function addMonths(date, months) {
    const d = new Date(date.getTime());
    const day = d.getDate();
    d.setMonth(d.getMonth() + months);
    if (d.getDate() < day) d.setDate(0);
    return d;
  }

  function daysBetween(a, b) {
    const ms = 24 * 60 * 60 * 1000;
    return Math.ceil((b - a) / ms);
  }

  const cards = Array.from(document.querySelectorAll(".card"));

  async function loadSheetAndApply() {
    const sheetMap = new Map();

    try {
      const res = await fetch(SHEET_CSV_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("Falha ao baixar CSV: " + res.status);
      const csvText = await res.text();

      const rows = parseCSV(csvText);
      if (!rows.length) throw new Error("CSV vazio.");

      const headers = rows[0].map(h => normalize(h));
      const idxArea = headers.indexOf("area");
      const idxRev  = headers.indexOf("revisao");
      const idxEnt  = headers.indexOf("entrega");

      if (idxArea < 0 || idxRev < 0 || idxEnt < 0) {
        throw new Error("Cabeçalho inválido. Precisa: area, revisao, entrega.");
      }

      for (let i = 1; i < rows.length; i++) {
        const r = rows[i];
        const area = normalize(r[idxArea]);
        if (!area) continue;

        sheetMap.set(area, {
          revisaoISO: toISODateString(r[idxRev]),
          entregaISO: toISODateString(r[idxEnt])
        });
      }
    } catch (e) {
      console.warn("Não consegui carregar a planilha. Vou usar os dados do HTML.", e);
      return; // mantém o HTML como fallback
    }

    cards.forEach(card => {
      const areaKey = normalize(card.getAttribute("data-area"));
      const row = sheetMap.get(areaKey);
      if (!row) return;
      if (row.revisaoISO) card.setAttribute("data-revisao", row.revisaoISO);
      if (row.entregaISO) card.setAttribute("data-entrega", row.entregaISO);
    });
  }

  function calcStatusAndRender() {
    const root = getComputedStyle(document.documentElement);

    cards.forEach(card => {
      const last = parseISODate(card.getAttribute("data-revisao"));
      const delivery = parseISODate(card.getAttribute("data-entrega"));

      const lastEl = card.querySelector(".last-review");
      const nextEl = card.querySelector(".next-review");
      const delEl  = card.querySelector(".delivery-date");
      const badgeEl = card.querySelector(".status-review");
      const pillEl = card.querySelector(".status");

      if (lastEl) lastEl.textContent = formatBR(last);
      if (delEl)  delEl.textContent  = formatBR(delivery);

      let statusText = "SEM DATA";

      if (!last) {
        if (nextEl) nextEl.textContent = "—";
        card.setAttribute("data-status", statusText);

        if (badgeEl) {
          badgeEl.textContent = statusText;
          badgeEl.className = "badge badge-vencido status-review";
        }
        if (pillEl) {
          pillEl.textContent = "G&R";
          pillEl.style.background = "#64748b";
        }
        return;
      }

      const next = addMonths(last, 6);
      if (nextEl) nextEl.textContent = formatBR(next);

      const today = new Date();
      today.setHours(0,0,0,0);
      next.setHours(0,0,0,0);

      const diff = daysBetween(today, next);

      if (diff < 0) statusText = "VENCIDO";
      else if (diff <= ALERT_DAYS) statusText = "ALERTA";
      else statusText = "OK";

      card.setAttribute("data-status", statusText);

      if (badgeEl) {
        if (statusText === "VENCIDO") {
          badgeEl.textContent = "VENCIDO";
          badgeEl.className = "badge badge-vencido status-review";
        } else if (statusText === "ALERTA") {
          badgeEl.textContent = "ALERTA";
          badgeEl.className = "badge badge-alerta status-review";
        } else {
          badgeEl.textContent = "OK";
          badgeEl.className = "badge badge-ok status-review";
        }
      }

      if (pillEl) {
        pillEl.textContent = statusText;
        if (statusText === "VENCIDO") pillEl.style.background = root.getPropertyValue('--vencido');
        else if (statusText === "ALERTA") pillEl.style.background = root.getPropertyValue('--alerta');
        else pillEl.style.background = root.getPropertyValue('--ok');
      }
    });
  }

  function updateSummary(visibleCards){
    let ok = 0, alerta = 0, vencido = 0;

    visibleCards.forEach(c=>{
      const s = c.getAttribute("data-status");
      if (s === "OK") ok++;
      else if (s === "ALERTA") alerta++;
      else if (s === "VENCIDO") vencido++;
    });

    document.getElementById("sumTotal").textContent = visibleCards.length;
    document.getElementById("sumOk").textContent = ok;
    document.getElementById("sumAlerta").textContent = alerta;
    document.getElementById("sumVencido").textContent = vencido;
  }

  const input = document.getElementById('searchInput');
  const clearBtn = document.getElementById('clearBtn');
  const resultCount = document.getElementById('resultCount');
  const noResults = document.getElementById('noResults');
  const filterBtns = Array.from(document.querySelectorAll(".filter-btn"));
  let activeFilter = "ALL";

  function applyFilters(){
    const term = normalize(input.value.trim());
    let visible = 0;
    const visibleCards = [];

    cards.forEach(card => {
      const area = normalize(card.getAttribute('data-area'));
      const status = card.getAttribute("data-status") || "";
      const matchText = (term === "" || area.includes(term));
      const matchStatus = (activeFilter === "ALL" || status === activeFilter);

      const show = matchText && matchStatus;
      card.style.display = show ? "" : "none";

      if (show){
        visible++;
        visibleCards.push(card);
      }
    });

    resultCount.textContent = visible + " área(s) exibida(s)";
    noResults.style.display = (visible === 0) ? "block" : "none";
    updateSummary(visibleCards);
  }

  clearBtn.addEventListener('click', function () {
    input.value = "";
    input.focus();
    applyFilters();
  });

  input.addEventListener('input', applyFilters);

  filterBtns.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      filterBtns.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      activeFilter = btn.getAttribute("data-filter");
      applyFilters();
    });
  });

  (async function init(){
    await loadSheetAndApply();
    calcStatusAndRender();
    applyFilters();
  })();
})();
</script>

<script>
  window.addEventListener("load", () => {
    document.body.classList.add("page-loaded");
  });
</script>

</body>
</html>