<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Seguran√ßa do Paciente ‚Äì AME Itapevi</title>
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="../assets/css/base.css">
</head>

<body>

<!-- ===== TOPBAR ===== -->
<div class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <img src="../assets/img/logo-ame.png" alt="Logo AME">
      <div class="brand-title">
        <strong>AME - Itapevi</strong>
        <span>Seguran√ßa do Paciente</span>
      </div>
    </div>

    <nav class="nav">
      <a href="../">Portal do AME - Itapevi</a>
      <a href="../gr/">G&amp;R</a>
      <a href="../protocolos/">Protocolos</a>
      <a href="#protocolos">Seguran√ßa do Paciente</a>
    </nav>
  </div>
</div>

<!-- ===== BANNER ===== -->
<header class="site-header">
  <div class="site-banner">
    <div class="site-banner-bg"></div>
    <div class="site-title">SEGURAN√áA DO PACIENTE</div>
  </div>
</header>

<div class="container">

<!-- ===== HERO ===== -->
<section id="protocolos" class="hero">
  <div class="hero-text">
    <div class="chip-row">
      <span class="chip chip-blue">Assistencial</span>
      <span class="chip chip-green">Seguran√ßa do Paciente</span>
    </div>

    <h2>Seguran√ßa do Paciente</h2>

    <p>
      A Seguran√ßa do Paciente √© um princ√≠pio central no cuidado em sa√∫de do AME ‚Äì Ambulat√≥rio
      M√©dico de Especialidades de Itapevi, orientando todas as a√ß√µes assistenciais,administrativas
      e gerenciais da unidade. Seu objetivo √© reduzir riscos, prevenir incidentes e promover um
      ambiente assistencial seguro, √©tico e de alta qualidade.
    </p>

    <p>
      Por meio de pr√°ticas seguras, monitoramento cont√≠nuo e padroniza√ß√£o de processos, a unidade fortalece
      a cultura de seguran√ßa e contribui para melhores desfechos cl√≠nicos e para a experi√™ncia do paciente.
    </p>

        <div class="kpis">
          <div class="kpi">
            <div class="label">‚è≥ Periodicidade</div>
            <div class="value">24 meses</div>
          </div>
          <div class="kpi">
            <div class="label">‚ö†Ô∏è Crit√©rio de alerta</div>
            <div class="value">90 dias</div>
          </div>
          
          <div class="kpi">
            <div class="label">‚úÖ Acesso</div>
            <div class="value">PDF oficial</div>
          </div>
        </div>
  </div>

  <div class="hero-image">
    <img src="../assets/img/paciente.png" alt="Seguran√ßa do Paciente">
  </div>
</section>

<!-- ===== RESUMO ===== -->
<div class="section-title">
  <div>Resumo do painel <small>(contagem autom√°tica)</small></div>
</div>

<div class="summary">
  <div class="summary-card">
    <div class="slabel">Total de protocolos</div>
    <div class="svalue" id="sumTotal">0</div>
  </div>
  <div class="summary-card ok">
    <div class="slabel">OK</div>
    <div class="svalue" id="sumOk">0</div>
  </div>
  <div class="summary-card alerta">
    <div class="slabel">ALERTA</div>
    <div class="svalue" id="sumAlerta">0</div>
  </div>
  <div class="summary-card vencido">
    <div class="slabel">VENCIDO</div>
    <div class="svalue" id="sumVencido">0</div>
  </div>
</div>

<!-- ===== FILTROS ===== -->
<div class="filters">
  <button class="filter-btn active" data-filter="ALL">Todos</button>
  <button class="filter-btn" data-filter="OK">OK</button>
  <button class="filter-btn" data-filter="ALERTA">ALERTA</button>
  <button class="filter-btn" data-filter="VENCIDO">VENCIDO</button>
</div>

<!-- ===== BUSCA ===== -->
<div class="toolbar">
  <div class="search-wrap">
    <label><strong>Pesquisar protocolo:</strong></label>
    <input id="searchInput" type="text" placeholder="Ex.: Meta 1, Meta 2, Queda..." />
    <button id="clearBtn" type="button">Limpar</button>
  </div>
  <div id="resultCount"></div>
</div>

<div id="noResults">Nenhum protocolo encontrado.</div>

<!-- ===== CARDS ===== -->
<div class="cards-wrapper">
  <div class="cards" id="cardsContainer">

    <div class="card" data-protocolo="PR.QUALID.001">
  <h3>META 1 - Identifica√ß√£o do Paciente
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.001 - META 1 - Identifica√ß√£o do Paciente - Ver. 003.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

<div class="card" data-protocolo="PR.QUALID.004">
  <h3>META 2 - Comunica√ß√£o Efetiva
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.004 - META 2 - Comunica√ß√£o Efetiva - Ver.001.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

<div class="card" data-protocolo="PR.QUALID.005">
  <h3>META 3 - Medica√ß√£o Segura
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.005 - META 3 - Medica√ß√£o Segura - Ver.001.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

<div class="card" data-protocolo="PR.QUALID.006">
  <h3>META 4 - Cirurgia Segura
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.006 - META 4 - Cirurgia Segura - Ver.001.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

<div class="card" data-protocolo="PR.QUALID.007">
  <h3>META 5 - Higieniza√ß√£o das M√£os
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.007 - META 5 - Higieniza√ß√£o das M√£os - Ver.000.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

<div class="card" data-protocolo="PR.QUALID.008">
  <h3>META 6 - Preven√ß√£o de Queda
    <span class="status">...</span>
  </h3>
  <div class="links">
    <a href="PR.QUALID.008 - META 6 - Preven√ß√£o de Queda - Ver.003.pdf" target="_blank">Documento oficial</a>
  </div>
  <div class="meta">
    <div><strong>Revis√£o realizada em:</strong> <span class="last-review"></span></div>
    <div><strong>Pr√≥xima revis√£o:</strong> <span class="next-review"></span></div>
  </div>
</div>

  
</div>
</div>
      <div class="meta">      
        <div><strong>Respons√°vel t√©cnico:</strong> Gest√£o de Qualidade ‚Äì Wally Silva de Jesus</div>
        <div><strong>√öltima atualiza√ß√£o:</strong> 12/12/2025</div>
        
      </div>
    </section>

<footer class="footer">
  <span>¬© AME Itapevi ‚Äì Painel de Gerenciamento de Riscos e Oportunidades</span>
  <span class="footer-author">Projeto e desenvolvimento: Wally Silva de Jesus</span>
</footer>

</div>

<!-- ===== SCRIPT (CSV + STATUS + BUSCA + FILTROS) ===== -->
<script>
(function () {

  const SHEET_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vTo4vkSHi-CcGNgEz44oGIgcBpvdv-aGrPFuETPzgG36fG_6ArEjHDQ7dVRfWOiMPxaS_LkU4Ph29RH/pub?output=csv";

  const PERIOD_MONTHS = 24;
  const ALERT_DAYS = 90;

  function normalize(t){
    return (t || "")
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  }

  function parseCSV(text){
    const sep = text.includes(";") ? ";" : ",";
    return text.trim().split("\n").map(r => r.split(sep).map(c => c.trim()));
  }

  function parseISO(d){
    if(!d) return null;
    if(!/^\d{4}-\d{2}-\d{2}$/.test(d)) return null;
    const [y,m,day] = d.split("-").map(Number);
    return new Date(y, m-1, day);
  }

  function addMonths(date, m){
    const d = new Date(date);
    const day = d.getDate();
    d.setMonth(d.getMonth() + m);
    if (d.getDate() < day) d.setDate(0);
    return d;
  }

  function formatBR(d){
    return d ? d.toLocaleDateString("pt-BR") : "‚Äî";
  }

  function updateSummary(cards){
    let ok = 0, alerta = 0, vencido = 0;

    cards.forEach(card => {
      const s = card.getAttribute("data-status");
      if (s === "OK") ok++;
      else if (s === "ALERTA") alerta++;
      else if (s === "VENCIDO") vencido++;
    });

    document.getElementById("sumTotal").textContent = cards.length;
    document.getElementById("sumOk").textContent = ok;
    document.getElementById("sumAlerta").textContent = alerta;
    document.getElementById("sumVencido").textContent = vencido;
  }

  const cards = Array.from(document.querySelectorAll(".card"));

  fetch(SHEET_CSV_URL, { cache: "no-store" })
    .then(r => r.text())
    .then(csv => {

      const rows = parseCSV(csv);
      const header = rows.shift().map(normalize);

      const idxProt = header.indexOf("protocolo");
      const idxRev  = header.indexOf("revisao");

      const map = new Map();

      rows.forEach(r => {
        const key = normalize(r[idxProt]);
        const m = key.match(/pr\.qualid\.\d+/);
        if (m) map.set(m[0], r[idxRev]);
      });

      const today = new Date();
      today.setHours(0,0,0,0);

      cards.forEach(card => {
        const key = normalize(card.getAttribute("data-protocolo"));
        const iso = map.get(key);

        const last = parseISO(iso);
        const lastEl = card.querySelector(".last-review");
        const nextEl = card.querySelector(".next-review");
        const badge  = card.querySelector(".status");

        if (!last){
          lastEl.textContent = "‚Äî";
          nextEl.textContent = "‚Äî";
          badge.textContent = "SEM DATA";
          badge.style.background = "#64748b";
          card.setAttribute("data-status", "SEM DATA");
          return;
        }

        const next = addMonths(last, PERIOD_MONTHS);
        const diff = Math.ceil((next - today) / 86400000);

        lastEl.textContent = formatBR(last);
        nextEl.textContent = formatBR(next);

        if (diff < 0){
          badge.textContent = "VENCIDO";
          badge.style.background = "var(--vencido)";
          card.setAttribute("data-status", "VENCIDO");
        }
        else if (diff <= ALERT_DAYS){
          badge.textContent = "ALERTA";
          badge.style.background = "var(--alerta)";
          card.setAttribute("data-status", "ALERTA");
        }
        else{
          badge.textContent = "OK";
          badge.style.background = "var(--ok)";
          card.setAttribute("data-status", "OK");
        }
      });

      updateSummary(cards); // üî• agora SIM
    });

})();
</script>


<script>
(function updateResumoInicial(){

  const cards = Array.from(document.querySelectorAll(".card"));

  let ok = 0, alerta = 0, vencido = 0;

  cards.forEach(card => {
    const status = card.dataset.status;
    if (status === "OK") ok++;
    else if (status === "ALERTA") alerta++;
    else if (status === "VENCIDO") vencido++;
  });

  document.getElementById("sumTotal").textContent = cards.length;
  document.getElementById("sumOk").textContent = ok;
  document.getElementById("sumAlerta").textContent = alerta;
  document.getElementById("sumVencido").textContent = vencido;

})();

const searchInput = document.getElementById("searchInput");
const clearBtn = document.getElementById("clearBtn");
const cards = document.querySelectorAll(".card");
const noResults = document.getElementById("noResults");
const resultCount = document.getElementById("resultCount");

function normalize(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");
}

function applySearchAndFilter() {
  const term = normalize(searchInput.value);
  let visible = 0;

  cards.forEach(card => {
    const title = normalize(card.querySelector("h3")?.innerText || "");
    const protocolo = normalize(card.dataset.protocolo || "");

    const match =
      title.includes(term) ||
      protocolo.includes(term);

    card.style.display = match ? "" : "none";
    if (match) visible++;
  });

  noResults.style.display = visible === 0 ? "block" : "none";
  resultCount.textContent = `${visible} protocolo(s) encontrado(s)`;
}

searchInput.addEventListener("input", applySearchAndFilter);

clearBtn.addEventListener("click", () => {
  searchInput.value = "";
  applySearchAndFilter();
});

  // ===== SCROLL SUAVE NO MENU =====
  const topbar = document.querySelector('.topbar');
  document.querySelectorAll('.nav a[href^="#"]').forEach(link => {
    link.addEventListener('click', (e) => {
      const id = link.getAttribute('href');
      const target = document.querySelector(id);
      if (!target) return;

      e.preventDefault();
      const top = target.getBoundingClientRect().top + window.pageYOffset;
      const offset = (topbar ? topbar.offsetHeight : 0) + 10;
      window.scrollTo({ top: top - offset, behavior: 'smooth' });
    });
  });
</script>

<script>
  window.addEventListener("load", () => {
    document.body.classList.add("page-loaded");
  });
</script>

</body>
</html>